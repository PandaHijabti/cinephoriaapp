<div class="container py-4">
  <h2 class="reservation-title text-center mb-4">ğŸŸï¸ RÃ©servation de sÃ©ance</h2>
  <p class="text-center text-muted mb-4">Choisis un film, une date et un horaire.</p>

  <form (ngSubmit)="submit()" class="card p-3 shadow-sm reservation-card">

    <!-- Film -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Film</label>
      <select class="form-select"
              name="filmId"
              [(ngModel)]="form.filmId"
              (ngModelChange)="onFilmChange()"
              [ngClass]="{'is-invalid': submitted && !form.filmId}">
        <option [ngValue]="null">â€” SÃ©lectionner â€”</option>
        <option *ngFor="let film of films" [ngValue]="film.id">{{ film.title }}</option>
      </select>
      <div class="invalid-feedback">SÃ©lectionne un film.</div>
    </div>

    <!-- Date (proposÃ©e par le cinÃ©ma) -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Date de sÃ©ance</label>
      <select class="form-select"
              name="date"
              [(ngModel)]="form.date"
              (ngModelChange)="onDateChange()"
              [disabled]="availableDates.length === 0"
              [ngClass]="{'is-invalid': submitted && !form.date}">
        <option value="" disabled selected>â€” Choisir une date â€”</option>
        <option *ngFor="let d of availableDates" [value]="d">{{ d }}</option>
      </select>
      <div class="invalid-feedback">Choisis une date.</div>
    </div>

    <!-- Horaire -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Horaire</label>
      <select class="form-select"
              name="time"
              [(ngModel)]="form.time"
              [disabled]="availableTimes.length === 0"
              [ngClass]="{'is-invalid': submitted && !form.time}">
        <option [ngValue]="null">â€” Choisir un horaire â€”</option>
        <option *ngFor="let t of availableTimes" [ngValue]="t">{{ t }}</option>
      </select>
      <div class="invalid-feedback">Choisis un horaire.</div>
    </div>

    <!-- Places -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Nombre de places</label>
      <input type="number"
             min="1"
             class="form-control"
             name="seats"
             [(ngModel)]="form.seats"
             [ngClass]="{'is-invalid': submitted && (!form.seats || form.seats <= 0)}">
      <div class="invalid-feedback">Indique au moins 1 place.</div>
    </div>

    <!-- IdentitÃ© -->
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label fw-semibold">Nom et prÃ©nom</label>
        <input type="text"
               class="form-control"
               name="name"
               [(ngModel)]="form.name"
               [ngClass]="{'is-invalid': submitted && !form.name.trim()}">
        <div class="invalid-feedback">Ton nom est requis.</div>
      </div>
      <div class="col-md-6">
        <label class="form-label fw-semibold">Email</label>
        <input type="email"
               class="form-control"
               name="email"
               [(ngModel)]="form.email"
               [ngClass]="{'is-invalid': submitted && !isEmailValid(form.email)}">
        <div class="invalid-feedback">Email invalide.</div>
      </div>
    </div>

    <div class="d-flex gap-2 mt-4">
      <button type="submit" class="btn btn-primary" [disabled]="!isValid">
        <i class="bi bi-check2-circle me-1"></i> Valider la rÃ©servation
      </button>
      <button type="button" class="btn btn-outline-secondary"
              (click)="form={filmId: form.filmId,date:'',time:null,seats:null,name:'',email:''}; availableTimes=[]; submitted=false;">
        RÃ©initialiser
      </button>
    </div>
  </form>

  <div *ngIf="confirmationMsg" class="alert alert-success mt-3">
    {{ confirmationMsg }}
  </div>
</div>

